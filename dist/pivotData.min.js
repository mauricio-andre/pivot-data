/* @license pivot-data v1.0.2 | by mauricio-andre | (c) Infinitidata 2020 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).pivotData=t()}(this,(function(){"use strict";return(e,t)=>{if(!e)throw new Error("Field 'data' is required");if(!Array.isArray(e)||e.length<=0)throw new Error("Field 'data' must be an array with items");if(!t||void 0===t.groupField)throw new Error("Field 'groupField' is required");Array.isArray(t.groupField)||(t.groupField=[t.groupField]);const{groupField:r,keyPrefix:i="",linearData:l=!0,pivotField:n}=t,a=e=>e||!l?{}:[],o=(e,t,r)=>{let i=t,n=e;if(!l){const e=r.length-1;r.forEach(((t,r)=>{i[t]=i[t]||{},n=t,e>r&&(i=i[t])}))}return[i,n]},u=[],s={},d={},c=[],p=Object.keys(e[0]),f=a(i),h=[],y=p.filter((e=>!r.some((t=>String(t)===String(e)))&&e!==String(n)));let m=!1;if(l&&n){m=!0;let t=0;r.forEach((e=>{const r=`${i}${t}`;f[r]=null,d[e]=r,t+=1})),e.forEach((e=>{r.includes(e[n])||h.includes(e[n])||(h.push(e[n]),y.forEach((r=>{const l=`${i}${t}`;f[l]=null,d[`${e[n]}_${r}`]=l,t+=1})))}))}let F=null,g=0,w=null;u.push(r,h,y);return{data:e.reduce(((e,t)=>{const u=r.map((e=>t[e])),p=u.join("_"),h=n&&t[n];if(!Object.hasOwnProperty.call(s,p)){const t=l?Object.keys(s).length:u[0];[F,g]=o(t,e,u),w=p,s[p]=t,c[t]=r.length,F[g]=(({baseItem:e,groupFieldValue:t,hasPivotField:r,keyPrefix:i="",linearData:l})=>{let n=Array.isArray(e)?[...e]:{...e};return Object.keys(e).length<=0&&(n=[],(!l&&r||l&&""!==i)&&(n={})),l&&t.forEach(((e,t)=>{n[`${i}${t}`]=e})),n})({linearData:l,hasPivotField:Boolean(n),keyPrefix:i,groupFieldValue:u,baseItem:f})}let $=0;const b=s[p],k=y.reduce(((r,n)=>{const a=(({columnMap:e,countCurrentItems:t,countNewItems:r,key:i,keyPrefix:l="",linearData:n,pivotFieldValue:a})=>e&&Object.keys(e).length>0?e[`${a}_${i}`]:(n&&(i=r,l&&(i+=t)),`${l}${i}`))({columnMap:d,countCurrentItems:c[b],countNewItems:$,key:n,keyPrefix:i,linearData:l,pivotFieldValue:h});return r[a]=t[n],m&&(e[b][a]=t[n]),$+=1,r}),a(i));return m||(w!==p&&([F,g]=o(b,e,u)),F[g]=(({currentItems:e,hasPivotField:t,linearData:r,newItems:i,pivotFieldValue:l})=>!r&&t?(e[l]||(e[l]=[]),e[l].push(i),e):r&&Array.isArray(e)?[...e,...i]:(e.push(i),e))({currentItems:F[g],hasPivotField:Boolean(n),linearData:l,newItems:k,pivotFieldValue:h})),w=p,c[b]+=$,e}),a()),lineMap:s,columnMap:d,map:u}}}));
